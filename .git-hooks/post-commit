#!/bin/bash

# Function to URL-encode a string
urlencode() {
    local string="${1}"
    local encoded=""
    local length="${#string}"
    for (( i = 0; i < length; i++ )); do
        local c="${string:i:1}"
        case "${c}" in
            [a-zA-Z0-9.~_-]) encoded+="${c}" ;;
            *) encoded+=$(printf '%%%02X' "'${c}") ;;
        esac
    done
    echo "${encoded}"
}

commit_message=$(git log -1 --pretty=%B)
repo_url=$(git remote get-url origin)

# URL-encode the parameters
encoded_commit_message=$(urlencode "${commit_message}")
encoded_repo_url=$(urlencode "${repo_url}")

# Make the curl request with URL-encoded parameters
curl -X POST "${GCP_CF_ENDPOINT}?commit_message=${encoded_commit_message}&repo_url=${encoded_repo_url}"